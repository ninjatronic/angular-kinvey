!function(){"use strict";angular.module("kinvey",["ngResource","ngCookies","ngBase64"]).provider("$kinvey",["$base64",function(a){var b,c=3,d="https://baas.kinvey.com/",e="appdata/",f="user/",g="group/",h="rpc/",i="custom/",j="blob/",k={user:{"X-Kinvey-API-Version":c,Authorization:""},basic:{"X-Kinvey-API-Version":c,Authorization:""}};return{init:function(c){if(!c||!c.appKey||!c.appSecret)throw"$kinveyProvider.init requires an options object: {'appId':'YOUR APP ID','appSecret':'YOUR APP SECRET'}";b=c.appKey,k.user.Authorization=k.basic.Authorization="Basic "+a.encode(c.appKey+":"+c.appSecret)},$get:["$cookieStore","$resource","$http","$q",function(a,c,l,m){function n(a){return a&&a.document&&a.location&&a.alert&&a.setInterval}function o(a){return a&&a.$evalAsync&&a.$watch}function p(a,b){var c=b;if("string"==typeof a&&"$"===a.charAt(0)){var d=!1;angular.forEach(F,function(b){b==a&&(d=!0)}),d||(c=void 0)}else n(b)?c="$WINDOW":b&&document===b?c="$DOCUMENT":o(b)&&(c="$SCOPE");return c}function q(a,b){return"undefined"==typeof a?void 0:JSON.stringify(a,p,b?"  ":null)}function r(a,b){var c=m.defer(),d=b||{};return"$resolved"in d||(d.$resolved=!1),d.$promise=c.promise,a(d,c),d}function s(a,b,c){return function(d){var e=c?c(d):d;angular.extend(a,e),a.$resolved=!0,b.resolve(e)}}function t(a,b){return function(c){var d=b?b(c):c;a.reject(d)}}function u(a){angular.forEach(G,function(b){var c=a[b];a[b]=function(a,b,d,e){return a&&"query"in a&&(a.query=JSON.stringify(a.query)),c(a,b,d,e)}});var b=a.group;return a.group=function(a){return a.reduce&&(a.reduce=a.reduce.toString(),a.reduce=a.reduce.replace(/\n/g,""),a.reduce=a.reduce.replace(/\s/g,"")),b(a)},a}function v(a){return a.prototype.$download=function(){var a=this;return r(function(b,c){l(E.download(a)).then(s(b,c,x),t(c,x))})},a.prototype.$upload=function(a,b){var c=this;return r(function(d,e){l(E.upload(c,a,b)).then(s(d,e,x),t(e,x))})},a.prototype.$save=function(a){var b=this;return r(function(c,d){l(E.saveFile(b,a)).then(s(c,d,y),t(d,x))},b)},a.upload=function(a,b,c){return r(function(d,e){l(E.upload(a,b,c)).then(s(d,e,x),t(e,x))})},a.download=function(a){return r(function(b,c){l(E.download(a)).then(s(b,c,x),t(c,x))})},a.save=function(a,b){return r(function(c,d){l(E.saveFile(a,b)).then(s(c,d,y),t(d,x))},a)},a}function w(a){return a.save=function(a){return a._id?H.update(a):H.create(a)},a.prototype.$save=function(a){return a&&a._id&&!this._id&&(this._id=a._id),this._id?this.$update(a):this.$create(a)},a}function x(a){return a.data}function y(a){return new K(x(a))}function z(){return r(function(a,b){l(E.handshake()).then(s(a,b,x),t(b,x))})}function A(a,b){return r(function(c,d){l(E.rpc(a,b)).then(s(c,d,x),t(d,x))})}function B(a,b){if(a===b)throw"aliases must not attempt to overwrite $kinvey."+b}function C(a,b){B(b,"handshake"),B(b,"User"),B(b,"Group"),B(b,"Object"),B(b,"alias"),L[b]=H(a)}var D=a.get(b+":authToken");D&&(k.user.Authorization=D);var E={handshake:function(){return{method:"GET",url:d+e+b,headers:k.basic}},rpc:function(a,c){return{method:"POST",url:d+h+b+"/"+i+a,headers:k.user,data:c}},upload:function(a,b,c){return{method:"PUT",url:a._uploadURL,data:b,headers:angular.extend({"Content-Type":c,"Content-Length":b.length,Accept:void 0},a._requiredHeaders),transformRequest:angular.identity}},download:function(a){return{method:"GET",url:a._downloadURL}},saveFile:function(a,c){return{method:a._id?"PUT":"POST",url:d+j+b+(a._id?"/"+a._id:""),headers:angular.extend({"X-Kinvey-Content-Type":c},k.user),data:a}}},F=["$gt","$gte","$in","$lt","$lte","$ne","$nin","$or","$and","$not","$nor","$exists","$type","$mod","$regex","$where","$geoWithin","$geoIntersects","$near","$nearSphere","$all","$elemMatch","$size","$","$elemMatch","$slice"],G=["query","delete"],H=function(a){return w(u(c(d+e+b+"/"+a+"/:_id",{_id:"@_id"},{create:{method:"POST",transformResponse:function(b){return new(H(a))(angular.fromJson(b))},headers:k.user,params:{_id:""}},get:{method:"GET",transformResponse:function(b){return new(H(a))(angular.fromJson(b))},headers:k.user},count:{method:"GET",headers:k.user,params:{_id:"_count"}},update:{method:"PUT",transformResponse:function(b){return new(H(a))(angular.fromJson(b))},headers:k.user},"delete":{method:"DELETE",headers:k.user},query:{method:"GET",transformResponse:function(b){var c=[],d=angular.fromJson(b);return angular.forEach(d,function(b){c.push(new(H(a))(b))}),c},headers:k.user,isArray:!0,params:{_id:""}},group:{method:"POST",headers:k.user,isArray:!0,params:{_id:"_group"},transformRequest:function(a){return q(a)}}})))},I=u(c(d+f+b+"/:_id",{_id:"@_id"},{login:{method:"POST",params:{_id:"login"},transformResponse:function(c){return c=angular.fromJson(c),c.error||(k.user.Authorization="Kinvey "+c._kmd.authtoken,a.put(b+":authToken","Kinvey "+c._kmd.authtoken)),new I(c)},headers:k.user},current:{method:"GET",params:{_id:"_me"},transformResponse:function(a){return new I(angular.fromJson(a))},headers:k.user},logout:{method:"POST",params:{_id:"_logout"},transformResponse:function(){k.user.Authorization=k.basic.Authorization,a.remove(b+":authToken")},headers:k.user},signup:{method:"POST",headers:k.basic,transformResponse:function(c){return c=angular.fromJson(c),c.error||(k.user.Authorization="Kinvey "+c._kmd.authtoken,a.put(b+":authToken","Kinvey "+c._kmd.authtoken)),new I(c)}},get:{method:"GET",transformResponse:function(a){return new I(angular.fromJson(a))},headers:k.user},lookup:{method:"POST",transformResponse:function(a){var b=[];return a=angular.fromJson(a),angular.forEach(a,function(a){b.push(new I(a))}),b},headers:k.user,isArray:!0,params:{_id:"_lookup"}},save:{method:"PUT",transformResponse:function(a){return new I(angular.fromJson(a))},headers:k.user},query:{method:"GET",transformResponse:function(a){var b=[];return a=angular.fromJson(a),angular.forEach(a,function(a){b.push(new I(a))}),b},headers:k.user,isArray:!0,params:{_id:""}},"delete":{method:"DELETE",params:{hard:!0},headers:k.user},suspend:{method:"DELETE",headers:k.user},verifyEmail:{method:"POST",headers:k.basic,url:d+h+b+"/:username:email/user-email-verification-initiate",params:{username:"@username",email:"@email"},transformRequest:function(){return""}},resetPassword:{method:"POST",headers:k.basic,url:d+h+b+"/:username:email/user-password-reset-initiate",params:{username:"@username",email:"@email"},transformRequest:function(){return""}},checkUsernameExists:{method:"POST",headers:k.basic,url:d+h+b+"/check-username-exists"}})),J=c(d+g+b+"/:_id",{_id:"@_id"},{get:{method:"GET",headers:k.user},save:{method:"PUT",headers:k.user},"delete":{method:"DELETE",headers:k.user}}),K=v(u(c(d+j+b+"/:_id",{_id:"@_id"},{get:{method:"GET",headers:k.user,transformResponse:function(a){return new K(angular.fromJson(a))}},query:{method:"GET",headers:k.user,isArray:!0,params:{_id:""},transformResponse:function(a){var b=[];return angular.forEach(angular.fromJson(a),function(a){b.push(new K(a))}),b}},"delete":{method:"DELETE",headers:k.user}}))),L={handshake:z,User:I,Group:J,Object:H,File:K,alias:C,rpc:A};return L}]}}])}();